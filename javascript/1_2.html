<!doctype html>
<html>
  <head>
    <meta charset="UTF-8">
    <link href="/css/css.css" rel="stylesheet">
    <link href="/css/js.css" rel="stylesheet">
    <title>一章第二回 オブジェクトの実体 - JavaScript初級者から中級者になろう - uhyohyo.net</title>
    <script src="/script/top.js"></script>
  </head>
  <body class="javascript">
    <header>
      <h1><a href="/">uhyohyo.net</a></h1>
    </header>
    <main>
      <article>
        <h1>JavaScript初級者から中級者になろう</h1>
        <nav>
          <p><a href="index.html" rel="bookmark">戻る</a> | <a href="1_1.html" rel="prev">一章第一回</a> | <a href="1_3.html" rel="next">一章第三回</a></p>
        </nav>
        <h2>一章第二回　オブジェクトの実体</h2>
        <h3>オブジェクトの作成</h3>
        <p>前回、「<kbd>new Object()</kbd>」という書き方でオブジェクトを作れるということを解説しました。</p>
        <p>しかし、別の書き方があります。しかも、この書き方は、最初からオブジェクトにプロパティを持たせることができます。</p>
        <pre><code>aa = {
"aaa":"test",
"bbb":123
};

alert(aa.aaa);
alert(aa.bbb);</code></pre>
        <p>「test」「123」が表示されます。</p>
        <p>1行目〜4行目がオブジェクトをつくっている部分です。</p>
        <p>この書き方は、次のようになります。</p>
        <pre><code>{
プロパティ名 : 値,
プロパティ名 : 値,
...
}</code></pre>
        <p>つまり、「<kbd>プロパティ名:値</kbd>」の組を、「<kbd>,</kbd>」で区切って並べ、それを「<kbd>{ }</kbd>」で囲んでいるというわけです。ちなみに、今回分かりやすく改行していますが、実際は1行でも構いません。といっても、やはり複数行にまたがったほうが分かりやすいです。プロパティ名が「<kbd>"</kbd>」で囲まれていますが、実は囲んでも囲まなくても構いません。</p>

        <h3>オブジェクトの実体</h3>
        <p>さて、オブジェクトの実体とはどういうことかというと、実は<strong>オブジェクトそのものは変数に「代入」されているわけではなく</strong>、実体は変数の中ではなく別の所にあるということです。言っていることがとてもややこしいですが、次のサンプルを見ましょう。</p>
        <pre><code>var a = 3;
var b = a;
a = 5;
alert(a);
alert(b);</code></pre>
        <p>このコードのやっていることは簡単です。まずaに3を代入します。</p>
        <p>次にbにaを代入しています。ここで、<strong>aは3</strong>ですから、bには3が代入されます。</p>
        <p>その後、aには5が代入されます。aをアラートで表示すると、aは当然5です。bは、さっき代入された3です。</p>
        <p>これはまったく問題ないコードです。それでは、次のコードはどうでしょう。</p>
        <pre><code>var a = {"aaa" : 10};
var b = a;
a.aaa = 5;
alert(a.aaa);
alert(b.aaa);</code></pre>
        <p>似たようなことを、オブジェクトを使ってしています。</p>
        <p>まず、aに「プロパティaaaを持つオブジェクト」を代入しています。</p>
        <p>そして、bにaを代入しています。その後、a.aaaに5を代入しています。</p>
        <p>ここで、a.aaaを表示すると、さっき代入した5です。</p>
        <p>これはいいですが、次にb.aaaを表示すると、なんと<strong>5が表示されます</strong>。プロパティaaaが10のaをコピーしてbに代入したから、b.aaaは10のはずです。しかし、5が表示されたのです。</p>
        <p>ここに、「実体は代入されていない」ということが関係しています。普通の変数と、オブジェクトが入った変数の違いを図で説明してみます。</p>
        <p><img src="img4.gif" width="160" height="340" alt="変数の複製" class="ss">変数Aにある値が代入されています。</p>
        <p>「変数B = 変数A」のようにすると、変数Bに変数Aと同じものが代入されますが、このとき中身が<strong>複製されます</strong>。</p>
        <p>変数Aと変数Bには、同じ値でも別々に入っているので、変数Aに別の値を代入しても変数Bはそのままです。</p>
        <p style="clear:both"><img src="img5.gif" width="311" height="308" alt="参照の複製" class="ss">一方、オブジェクトの場合はどうでしょう。図の一番上は、変数Aにオブジェクトを代入したときの状態です。
          <code>A = {"aaa" : 10};</code>プロパティはaaaを持っていますね。</p>
        <p>しかし、図ではオブジェクトは右のほうにあり、実際に変数Aに入っているのは「<strong>参照</strong>」です（実はこれも完璧に正しい表現ではないらしいですが、これで十分でしょう）。</p>
        <p>そして、参照からは矢印が出て、オブジェクトを指しています。下の2つの参照からは矢印が出てませんが、見にくいので省略しているだけで、実際には全てオブジェクトを指しています。</p>
        <p>さて、「<strong>参照</strong>」は、「このオブジェクトはここにあります」ということを表すものです。つまり、本当は、オブジェクトはJavaScriptからは直接触れないところにあって、それを変数に代入された<strong>参照を通していじっている</strong>ということです。</p>
        <p>だから、上のサンプルの<code>a.aaa = 5;</code>は、正確には「aが表す（参照する）オブジェクトにあるプロパティaaaに5を代入する」ということです。</p>
        <p>だから、aが参照するオブジェクトのプロパティaaaに5が代入されるわけです。</p>
        <p>さて、これを<code>b = a;</code>のようにして複製したとき、どうなるでしょうか。</p>
        <p><strong>複製されるのは参照です</strong>。オブジェクトそのものは<strong>複製されません</strong>。参照が複製されるということは、当然同じオブジェクトを表すということです。</p>
        <p>だから、aもbも表すオブジェクトは<strong>同じ</strong>になり、その結果、aのプロパティaaaをいじろうがbのプロパティaaaをいじろうが結局は<strong>同じオブジェクトをいじっていた</strong>ということです。</p>
        <p>つまり、上のサンプルで「b.aaa」が5になっていたのは、「a.aaa」に5を代入した、つまり、a（とb）が表すオブジェクトのプロパティaaaに5を代入したからなのです。</p>

        <p>これはなかなか実際的な話です。「b = a;」のようにしてオブジェクトそのものを複製した気になって、変な動作をしてしまい困り果ててしまうということはありがちです。</p>
        <p>ちなみに、既にあるオブジェクトへの参照が代入されているaに、新たに<code>a = new Object();</code>のようにした場合、その新しいオブジェクトへの<strong>新しい参照</strong>が代入され、もともと参照していたオブジェクトとの関係は切れてしまいます。</p>


        <h3>オブジェクトとプリミティブ</h3>
        <p>オブジェクトとは、変数に代入したとき、その実体ではなく<strong>参照が代入される</strong>というものでした。</p>
        <p>それに対し、いままでこの解説では「値」と呼んでいた、実体がそのまま代入されるものを<dfn>プリミティブ</dfn>（プリミティブ値）といいます。</p>
        <p>「3」とか「"aaaaaaaaa"」とか「true」「false」とかです。ちなみに、プリミティブにも数値とか文字列とか真偽値とか種類がありますが、この種類を「型」といいます。</p>
        <nav>
          <p><a href="index.html" rel="bookmark">戻る</a> | <a href="1_1.html" rel="prev">一章第一回</a> | <a href="1_3.html" rel="next">一章第三回</a></p>
        </nav>
      </article>
    </main>
  </body>
</html>

