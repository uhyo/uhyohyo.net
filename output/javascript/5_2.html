<!doctype html>
<html lang="ja-jp">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link href="/css/css.css" rel="stylesheet">
                  <link href="/css/js.css" rel="stylesheet">
                        <title>五章第二回　CSSの構造 — JavaScript初級者から中級者になろう &#x2014; uhyohyo.net</title>
        <script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-46093038-1', 'auto');
ga('send', 'pageview');
    </script>
  </head>
  <body>
    <header>
      <h1>
        <a href="/">uhyohyo.net</a>
      </h1>
    </header>
    <main>
      
<article> 
  <h1>JavaScript初級者から中級者になろう</h1>
  <aside class="ad-javascript">
    <!-- Google Adsense -->
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:inline-block;width:180px;height:150px"
     data-ad-client="ca-pub-1080533149094679"
     data-ad-slot="7536196754"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </aside>
        <nav>
      <p>
        <a href="index.html" rel="bookmark">戻る</a>
                            |
          <a rel="prev" href="5_1.html">五章第一回</a>
                          |
          <a rel="next" href="5_3.html">五章第三回</a>
              </p>
    </nav>
    <h2>五章第二回　CSSの構造</h2>
<p>CSSは、文書中で独自の構造を持っています。今回から、その構造と操作について解説します。</p>

<h3>CSSStyleSheet</h3>
<p>CSSでも、それぞれの要素などは全てオブジェクトで表されます。まずは、そのうち<dfn>CSSStyleSheet</dfn>という種類のオブジェクトについて解説します。</p>
<p>CSSStyleSheetは、CSSそのもので最も大きなまとまりで、</p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;test&lt;/title&gt;
    &lt;style type="text/css"&gt;
      body {
          background-color: aqua;
      }
      div {
          background-color: white;
      }
      p {
          background-color: yellow;
      }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;testtest&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>というHTMLがあったとき、<code>&lt;style&gt;〜&lt;/style&gt;</code>の間の</p>
<pre><code>body {
  background-color: aqua;
}
div {
  background-color: white;
}
p {
  background-color: yellow;
}</code></pre>
<p>これ全体を表すオブジェクトです。<code>&lt;style&gt;〜&lt;/style&gt;</code>が2つ以上あった場合も、それぞれのstyle要素についてCSSStyleSheetがあります。また、link要素を使って外部のCSSを読み込んだ場合も、そのlink要素についてCSSStyleSheetがつくられます。</p>
<p>では、このCSSStyleSheetはどのように取得すればいいのでしょうか。</p>
<p>それには、documentが持つ<strong>styleSheets</strong>というオブジェクトを使います。前述の通りCSSStyleSheetはいくつもある可能性があるので、これはその文書が持つCSSStyleSheetのリストです。</p>
<p><dfn>length</dfn>プロパティはその数を表し、<dfn>item</dfn>メソッドでひとつひとつのCSSStyleSheetを取得できます。NodeListなどと似たような使い方ができます。例えば最初のスタイルシートを取得するには、</p>
        <pre><code>document.<mark>styleSheets</mark>.item(0)</code></pre>
<p>という感じです。また、省略形として<code>document.styleSheets[0]</code>というような形もあります。</p>
<p>さて、このCSSStyleSheetは、いろいろプロパティなどを持っています。いろいろ適当に紹介します。</p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;test&lt;/title&gt;
    &lt;style type="text/css"&gt;
      body {
          background-color: aqua;
      }
      div {
          background-color: white;
      }
      p {
          background-color: yellow;
      }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;testtest&lt;/p&gt;

    &lt;script type="text/javascript"&gt;
    var sheet = document.styleSheets.item(0);

    alert(sheet.disabled);
    sheet.disabled = true;
    console.log(sheet.ownerNode);
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>まず<dfn>disabled</dfn>というプロパティを表示しています。これは、そのスタイルシートを<strong>無効化するかどうか</strong>の設定で、<strong>真偽値</strong>です。最初は当然無効化されていないからfalseです。</p>
<p>alertで表示しても、falseが表示されます。その後、それをtrueに変更しています。trueということは無効化するということです。最初にアラートが出たときはまだスタイルシートが有効だから背景色がついていたのが、設定したあとはスタイルシートが無効になり背景色がつかなくなります。ちなみに今回console.logではなくわざわざalertを使っているのは、変化前と後を比べられるようにするためです。</p>
<p>次の行で出ているのは、<dfn>ownerNode</dfn>というプロパティです。その名の通り、ノードが入っています。どんなノードかというと、そのスタイルシートのもととなるノードで、今回の場合、このスタイルシートはstyle要素によって作られたから、style要素のノードが入っています。</p>
<p>他にもありますが、とりあえずこの程度でしょう。</p>

<h3>CSSRule</h3>
<p>さて、CSSStyleSheetは、</p>
<pre><code>body {
    background-color: aqua;
}
div {
    background-color: white;
}
p {
    background-color: yellow;
}
          </code></pre>
<p>これ全体を表すものでした。これは、さらに細かく分けることができます。具体的には、</p>
<pre><code>body {
    background-color: aqua;
}</code></pre>
<pre><code>div {
    background-color: white;
}</code></pre>
<pre><code>p {
    background-color: yellow;
}</code></pre>
<p>の3つに分かれます。このスタイルシートは、<code><var>セレクタ</var> { 〜 }</code>の組が3つととらえることができますね。ちなみに、セレクタとは、そのスタイルが適用される範囲を指定する部分です。今回の場合、「body」「div」「p」の部分です。</p>

<p>このひとつひとつを表す<dfn>CSSRule</dfn>というオブジェクトがあります。そもそもCSSのセレクタとスタイルの組のことをルールというので、CSSRuleという名前はそこから来ています。これらは、全体を司るCSSStyleSheetの下にあると考えることができます。これは、ノードの親と子の関係に似ていて、次のように表せます。</p>
<pre><code>CSSStyleSheet
｜
├――CSSRule
｜
├――CSSRule
｜
└――CSSRule
          </code></pre>
<p>これらはCSSStyleSheet側から取得することができます。</p>
<p>CSSStyleSheetは<dfn>cssRules</dfn>というプロパティを持ち、それが、そのスタイルシートが持つCSSRuleのリストです。これまた、lengthプロパティとitemメソッドを持っています。このitemメソッドが返すのが、それぞれのCSSRuleです。</p>
<p>だから、例えば</p>
        <pre><code>document.styleSheets.item(0).<mark>cssRules</mark>.item(0)</code></pre>
<p>のようにして取得します。こうしてみると長いですが、もちろん適宜<code>document.styleSheets.item(0)</code>を変数に代入するなどします。さて、上のサンプルの場合、最初のcssRuleは</p>
<pre><code>body {
  background-color: aqua;
}</code></pre>
<p>の部分のCSSRuleだから、それが返ってくることになります。</p>
<p>さて、それではこのCSSRuleからスタイルについての情報を得る方法ですが、いくつは方法はあります。ひとつは、<dfn>cssText</dfn>プロパティを見る方法です。</p>
<p>このcssTextには、そのCSSRuleが表す部分の文字列がそのまま入っています。例えば、</p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;test&lt;/title&gt;
    &lt;style type="text/css"&gt;
      body {
          background-color: aqua;
      }
      div {
          background-color: white;
      }
      p {
          background-color: yellow;
      }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;testtest&lt;/p&gt;

    &lt;script type="text/javascript"&gt;
      var cssrule = document.styleSheets.item(0).cssRules.item(0);

      console.log(cssrule.<mark>cssText</mark>);
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
          </code></pre>
<p>のようにしたら、最初のCSSRuleは</p>
<pre><code>body {
  background-color: aqua;
}</code></pre>
<p>の部分だから、それが表示されます。ただし、前回解説したのと同じで、書いてあるソースがそのままそっくり表示されているというわけではないかもしれません。しかし意味は同じはずです。</p>

<p>しかし、このように文字列で取得すると、人間から見ると分かりやすいですが、プログラムからは扱いづらいです。そこで、もっとプログラムで扱いやすい方法を紹介していきます。</p>

<h3>CSSStyleRule</h3>
<p>実は、CSSRuleには、さらに何種類も種類があります。今まで扱ってきた</p>
<pre><code><var>セレクタ</var> {
    スタイル
}</code></pre>
<p>という書式で具体的にスタイルを記述するものは、<dfn>CSSStyleRule</dfn>というオブジェクトで表されます。他にどんな種類があるかは後述します。</p>
<p>上のサンプルでは3つCSSRuleがありましたが、いずれもCSSStyleRuleです。それ以外の種類は出てきてません。</p>
<p>このCSSStyleRuleしか持たないプロパティが2つあります。</p>
<p>ひとつは<dfn>selectorText</dfn>です。これには、セレクタの部分が文字列で入っています。</p>
<pre><code>body {
    background-color: aqua;
}</code></pre>
<p>の場合、セレクタは"body"ですね。このプロパティは<strong>変更可能</strong>です。</p>
<p>もうひとつは<dfn>style</dfn>です。このプロパティは<strong>CSSStyleDeclaration</strong>です。このCSSStyleDeclarationは前回出てきたもので、これを通してひとつひとつのCSSのプロパティを扱うことができるのでした。</p>
<p>このstyleが表すスタイルは、当然このCSSStyleRuleのスタイル指定です。ここを試しに変更してみましょう。</p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;test&lt;/title&gt;
    &lt;style type="text/css"&gt;
      body {
          background-color: aqua;
      }
      div {
          background-color: white;
      }
      p {
          background-color: yellow;
      }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;testtest&lt;/p&gt;

    &lt;script type="text/javascript"&gt;
      var cssrule = document.styleSheets.item(0).cssRules.item(0);

      cssrule.<mark>style</mark>.backgroundColor = "blue";
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>JavaScriptによってbackground-colorを"blue"に変更したので、背景色が青になっています。</p>
<p>また、CSSStyleDeclarationを操作ためのメソッドがいくつかあるので、紹介しておきます。最初に紹介するのは<dfn>setProperty</dfn>です。これは名前の通り、1つのプロパティの値をセットするものです。第一引数がプロパティ名で、第二引数が値です。つまり、端的にいえば、上のサンプルの</p>
        <pre><code>cssrule.style.backgroundColor = "blue";</code></pre>
<p>は次の文と同じ意味です。</p>
        <pre><code>cssrule.style.<mark>setProperty</mark>("background-color","blue");</code></pre>
<p>この書き方では、プロパティ名を文字列で指定するためハイフンマイナスの入ったプロパティ名もそのまま指定することができます。</p>
<p>また今回は省略しましたが、実は第三引数を指定することが可能です。これは文字列で、ようするに<code>"important"</code>を指定することができます。この指定をすると、</p>
        <pre><code>background-color: blue <mark>!important</mark>;</code></pre>
<p>と指定したのと同じ意味になります。</p>
<p>逆に、セットされているプロパティの値を知るためのメソッド<dfn>getPropertyValue</dfn>もあります。これは引数が一つだけで、プロパティ名です。つまり上の例のあとだと、<code>cssrule.style.<mark>getPropertyValue</mark>("background-color")</code>は<code>"blue"</code>あるいは<code>"#0000ff</code>などの値が返ってきます。返り値は常に文字列で、もしそのプロパティがセットされていなかったら<code>""</code>が返ってきます。</p>
<p>また、値ではなく<code>important</code>に相当する部分を取得するメソッド<dfn>getPropertyPriority</dfn>もあります。これも引数はプロパティ名です。もしなければこれまた<code>""</code>が返ってきます。</p>
<p>次に、プロパティを削除するメソッド<dfn>removeProperty</dfn>を紹介します。これも引数がプロパティ名で、例えば</p>
        <pre><code>cssrule.style.<mark>removeProperty</mark>("background-color");</code></pre>
<p>とした場合、<code>background-color: blue;</code>という一文が無かったことになります。</p>
<p>最後に、そのCSSStyleDeclarationにセットされているプロパティを全て調べたりするために、<dfn>length</dfn>プロパティと<dfn>item</dfn>メソッドがあります。itemメソッドには0から(length-1)までの数値を引数として渡すことができ、その番号に対応した<strong>プロパティ名</strong>が返ります。上のだと<code>cssrule.style.<mark>length</mark></code>は1で、<code>cssrule.style.<mark>item</mark>(0)</code>は<code>"background-color"</code>が返ります。</p>


<h3>その他のCSSRule</h3>
<p>それでは、CSSStyleRule以外のCSSRuleについて解説します。</p>
<p>どういう場合にそれらが発生するのかというと、</p>
<pre><code><var>セレクタ</var> {
    スタイル
}</code></pre>
<p>という形以外の記述があった場合にそれらが発生します。これ以外の書き方なんて見かけた事ないという人もいつかもしれませんが、この機会に知っておきましょう。</p>

<h4>CSSCharsetRule</h4>
<p><code>@charset "UTF-8";</code>
  のような記述がスタイルシートの先頭にあることがあります。見ての通り、そのスタイルシートの文字コードを書いておきます。HTML中にstyle要素を使って書く場合は、HTML文書の文字コードと同じである必要があります。</p>
<p>この文でひとつのCSSRuleが作られます。このとき作られるのは、<dfn>CSSCharsetRule</dfn>というものです。</p>
<p>このCSSCharsetRuleが持つプロパティには、<dfn>encoding</dfn>があります。これは簡単で、指定された文字コードが文字列で入っています。この場合は"UTF-8"ですね。</p>

<h4>CSSCharsetRule</h4>
<p><dfn>CSSFontFaceRule</dfn>は、次のような指定があるとき登場します。</p>
<pre><code>@font-face {
  font-family: "testtesttest";
  src: url("http://example.com/test.ttf");
}</code></pre>
<p>詳しい説明は省きますが、見て分かる通り、普通にスタイルを記述するのと同じ書式で設定をしているので、CSSStyleRuleと同じようにstyleプロパティを持ちます。</p>

<h4>CSSImportRule</h4>
<p><dfn>CSSImportRule</dfn>は、次のような指定があるとき登場します。</p>
        <pre><code>@import "style.css";</code></pre>
<p>これは、スタイルシートの中から、別のスタイルシートを読み込むという指定です。HTMLから外部のcssを読み込むにはlink要素を使いますが、このようにCSS中からも読み込むことができます。</p>
<p>読み込み先のURLは、<dfn>href</dfn>というプロパティに入っています。これは書き換えできません。書き換えて読み込み先のファイルを変えるというような使い方はできません。</p>
<p>また、読み込んだスタイルシートをDOMで操作する方法もちゃんとあります。スタイルシートのファイルをまるまる1個読み込むのだから、読み込んだスタイルシートのファイルは上で解説した<strong>CSSStyleSheet</strong>で表されるはずです。</p>
<p>それは、<dfn>styleSheet</dfn>というプロパティで取得できます。これがあると、上ででてきた木構造も複雑になります。</p>
<pre><code>CSSStyleSheet
｜
├――CSSStyleRule
｜
└――<mark>CSSImportRule</mark>
　　　　　｜
　　　　　└――CSSStyleSheet
　　　　　　　　　　｜
　　　　　　　　　　├――CSSStyleRule
　　　　　　　　　　…
          </code></pre>
<p>という感じになりますね。</p>

<h4>CSSMediaRule</h4>
<p><dfn>CSSMediaRule</dfn>は、次のような指定があるとき登場します。</p>
<pre><code>@media screen {
  スタイル
}</code></pre>
<p>これはメディアによって適用されるスタイルを変えるための指定です。メディアとは、どういう手段でそのページを表示するかということです。</p>
<p>「当然パソコン（ブラウザ）で表示するに決まってる」と思うかもしれませんが、CSSではさまざまなメディアに対応ができるようになっています。</p>
<p>例えば上にもある「screen」なら普通にパソコンなどのブラウザで、他に「print」なら印刷時のときのスタイル、「aural」なら音声読み上げブラウザ用、「tty」なら携帯端末などの限られた表示領域を持つもの用…などと決められています。</p>
<p>つまり、パソコンで表示したときと印刷しようとしたときでは見た目が違うなんてことが起こりうるわけです。</p>
<p>さて、上の場合「screen」だから普通にパソコンで表示したときのみ適用されるスタイルを記述するわけですが、具体的にどこに記述するかというと、</p>
<pre><code>@media screen {
  body {
    background-color: yellow;
    font-size:100em;
  }
  div {
    font-size:100em;
  }
}</code></pre>
<p>のように、<code>@media { 〜 }</code>の中に記述します。</p>
<p>ここで注目するのが、CSSMediaRuleはあくまで<code>@media { 〜 }</code>をひとまとまりにして扱うので、そのCSSMediaRuleが別のCSSRuleを内包しているということです。</p>
<pre><code>CSSStyleSheet
｜
├――CSSStyleRule
｜
└――<mark>CSSMediaRule</mark>
　　　　　　｜
　　　　　　├――CSSStyleRule
　　　　　　…
          </code></pre>
<p>という状態ですね。</p>
<p>これらを扱うために、CSSMediaRuleも、CSSStyleSheetと同じように<strong>cssRules</strong>を持っていて、同じように扱うことができます。これは前述のCSSImportRuleと違い、CSSStyleSheetを介さない点で違うので注意してください。CSSImportRuleはあくまで別のまとまりとしてのCSSを読み込むということでこのような違いが生じています。</p>
<p>また、どのメディアを対象にしているかを知るために、<strong>media</strong>というプロパティを持っています。このプロパティは<dfn>MediaList</dfn>というもので、名前のとおり対象となるメディアのリストです。</p>
<p>lengthとitemを持つリストです。itemは、メディアひとつを文字列で返します。また、mediaTextというプロパティは、メディアを全てコンマで区切ってまとめた文字列です。</p>

<h4>CSSPageRule</h4>
<p><dfn>CSSPageRule</dfn>は、次のような場合に登場します。</p>
<pre><code>@page {
  スタイル
}</code></pre>
<p>これは、</p>
<pre><code>@page {
  margin: 3px;
}</code></pre>
<p>のように中にスタイルを記述できるので、それを取得するためにstyleプロパティを持ちます。これはCSSStyleDeclarationだから、CSSStyleRuleのそれと同様に扱えます。</p>
<p>また、</p>
<pre><code>@page<mark>:first</mark> {
}</code></pre>
<p>のような場合にセレクタ部分を取得するために、selectorTextというプロパティも持っています。これは文字列で、今回の場合"@page:first"のように入っています。</p>


<p>とりあえず、これでCSSRuleの種類をすべて解説しました。CSSStyleSheetなどのcssRulesには、いろいろな種類のCSSRulesが一直線に並んで入っていることになります。CSSStyleSheet以外は書かないよという人はいいですが、どんな種類か分からないCSSRuleがあるとき、それの種類を知る必要があることもあります。</p>
<p>その方法はちゃんとあります。どんなCSSRuleも、<dfn>type</dfn>というプロパティを持っていて、この値によってどの種類のCSSRuleであるか判別できます。この値は数値です。</p>
<p>1から順番に、CSSStyleRule、CSSCharsetRule、CSSImportRule、CSSMediaRule、CSSFontFaceRule、CSSPageRuleとなっています。</p>
<p>typeの値とこれらの数値を比較すればいいわけです。例えば、typeが1ならそれはCSSStyleRuleであることがわかります。</p>
<p>しかし、数値を比較すると分かりにくいので、<strong>定数</strong>というものがあります。</p>
<p>定数とは、変数のように値に名前がついたものですが、その値は固定されています。定数に名前がついていることによって、その数値が何を意味するのかが分かりやすくなります。</p>
<p>具体的に、1から順にSTYLE_RULE,CHARSET_RULE,IMPORT_RULE,MEDIA_RULE,FONT_FACE_RULE,PAGE_RULEという名前の定数があります。上と対応していますね。これらは、CSSRuleのプロパティとして参照することができます。つまり、変数aaaがあるCSSRuleであるとき、</p>
        <pre><code>aaa.type == aaa.<mark>STYLE_RULE</mark></code></pre>
<p>とすることでaaaがCSSSTyleRuleである場合のみ処理をしたりできます。見た目にも、それがCSSStyleRuleであることを確かめているのが分かりやすいと思います。これが
</p>
        <pre><code>aaa.type == 1</code></pre>
<p>であると、やっていることは同じですが、上と比べて分かりにくいですね。</p>

<p>今回は構造を知って参照するだけでしたが、次回はさまざまな操作などを解説します。</p>
        <nav>
      <p>
        <a href="index.html" rel="bookmark">戻る</a>
                            |
          <a rel="prev" href="5_1.html">五章第一回</a>
                          |
          <a rel="next" href="5_3.html">五章第三回</a>
              </p>
    </nav>
  </article>

    </main>
  </body>
</html>
    
