<!doctype html>
<html lang="ja-jp">
  <head>
    <meta charset="UTF-8">
    <link href="/css/css.css" rel="stylesheet">
                  <link href="/css/js.css" rel="stylesheet">
                        <title>二章第七回　木構造の操作：さまざまな機能2 — JavaScript初級者から中級者になろう &#x2014; uhyohyo.net</title>
        <script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-46093038-1', 'auto');
ga('send', 'pageview');
    </script>
  </head>
  <body>
    <header>
      <h1>
        <a href="/">uhyohyo.net</a>
      </h1>
    </header>
    <main>
      
<article> 
  <h1>JavaScript初級者から中級者になろう</h1>
  <aside class="ad-javascript">
    <!-- Google Adsense -->
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:inline-block;width:180px;height:150px"
     data-ad-client="ca-pub-1080533149094679"
     data-ad-slot="7536196754"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </aside>
        <nav>
      <p>
        <a href="index.html" rel="bookmark">戻る</a>
                            |
          <a rel="prev" href="2_6.html">二章第六回</a>
                          |
          <a rel="next" href="2_8.html">二章第八回</a>
              </p>
    </nav>
    <h2>二章第七回　木構造の操作：さまざまな機能2</h2>
<h3>兄弟ノード</h3>
<p>DOMには、兄弟ノードを取得する方法もあります。</p>
<p>ここで、兄弟ノードとは、同じ親を持つノードのことです。例えば、</p>
<pre><code>AAA
｜
├――BBB
｜
├――CCC
｜
└――DDD
        </code></pre>
<p>という木構造があったとき、BBB,CCC,DDDは全て、同じAAAという親を持つ兄弟ノードです。</p>
<p>あるノードの兄弟ノードを取得するには、プロパティ<dfn>previousSibling</dfn>と<dfn>nextSibling</dfn>を使います。</p>
<p>previousSiblingはそのノードの1つ前の兄弟、nextSiblingは1つ後の兄弟です。</p>
<p>実際のサンプルで見てみましょう。</p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;test&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;&lt;strong&gt;a&lt;/strong&gt;&lt;em id="aaa"&gt;b&lt;/em&gt;&lt;ins&gt;c&lt;/ins&gt;&lt;/p&gt;

    &lt;script type="text/javascript"&gt;
      var aaa = document.getElementById('aaa');

      var prev = aaa.<dfn>previousSibling</dfn>;
      var next = aaa.<dfn>nextSibling</dfn>;

      alert(prev.tagName);
      alert(next.tagName);
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
        </code></pre>
<p>このサンプルの木構造はこうです。</p>
<pre><code> p
｜
├――strong
｜　　｜
｜　　└――#text
｜
├――<mark>em</mark>
｜　　｜
｜　　└――#text
｜
└――ins
　　　｜
　　　└――#text
        </code></pre>
<p>ここで、変数aaaには、"aaa"というidを持つ要素、つまりem要素のノードを代入しています。</p>
<p>prevとnextには、それぞれpreviosSiblingとnextSiblingが代入されています。</p>
<p>つまり、</p>
<pre><code> p
｜
├――<mark>strong</mark>　　　　←previousSibling
｜　　｜
｜　　└――#text
｜
├――em
｜　　｜
｜　　└――#text
｜
└――<mark>ins</mark>　　　　　 ←nextSibling
　　　｜
　　　└――#text
          </code></pre>
<p>このようになっているから、prevにはstrong要素のノード、nextにはins要素のノードが代入されているはずです。</p>
<p>それを確かめているのが次の2行で、tagNameを表示しています。予想通り、「STRONG」と「INS」が表示されるはずです。</p>
<p>ちなみに、兄弟ノードを全てまとめて（NodeListの形で）取得することは、今までの知識でもできます。<code>aaa.parentNode.childNodes</code>ですね。</p>

<h3>replaceChild</h3>
<p><dfn>replaceChild</dfn>は、<strong>ノード</strong>が持つプロパティで、そのノードが持つある子ノードを、別のノードに<strong>置き換えます</strong>。</p>
<p>実際のサンプルを見てみましょう。</p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;test&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p id="aaaaa"&gt;t&lt;strong&gt;es&lt;/strong&gt;t&lt;/p&gt;

    &lt;script type="text/javascript"&gt;
      var p = document.getElementById('aaaaa');

      var newnode = document.createElement('em');
      newnode.appendChild(document.createTextNode('置き換えるノード'));

      p.<dfn>replaceChild</dfn>(newnode, p.firstChild);
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
        </code></pre>
<p>このサンプルでは、P要素の最初の子ノードと、新しくつくったem要素を置き換えています。</p>
<p>まず、getElementByIdで</p>
<pre><code> <mark>p</mark>　　　　　　　←これ
            ｜
            ├――#text
            ｜
            ├――strong
            ｜　　　｜
            ｜　　　└――#text
            ｜
            └――#text
        </code></pre>
<p>を取得します。</p>
<p>その後、新しいem要素をcreateElementで作り、newnodeに代入しています。その後、そのem要素にdocument.createTextNodeで作ったテキストノードを子として追加しています。このように返り値を直接引数として渡すことで、テキストノードをいちいち変数に代入しなくてもよくなります。</p>
<p>つまり、</p>
<pre><code>em
｜
└――#text　　　　"置き換えるノード"
          </code></pre>
<p>を作ったということですね。</p>
<p>その後、いよいよp.replaceChildを呼び出しています。1つめの引数が新しく作ったノードで、2つめの引数は、firstChild、つまり</p>
<pre><code> p
｜
├――<mark>#text</mark>　　　　　　　←これ
｜
├――strong
｜　　　｜
｜　　　└――#text
｜
└――#text
        </code></pre>
<p>ですね。</p>
<p>実は、1つめの引数が置き換え後のノードで、2つめの引数が置き換え前のノードです。</p>
<p>つまり、p.firstChildをnewnodeに置き換えるという処理をしているわけです。つまり、次のようになります。</p>
<pre><code> p
｜
├――<mark>#text</mark>　　　　　　　"t"
｜
├――strong
｜　　　｜
｜　　　└――#text　　　"es"
｜
└――#text　　　　　　　"t"

↓↓↓

 p
｜
├<mark class="ins">―――em</mark>
｜　　　<mark class="ins">｜</mark>
｜　　　<mark class="ins">└――#text</mark>　　　"置き換えるノード"
｜
├――strong
｜　　　｜
｜　　　└――#text　　　"es"
｜
└――#text　　　　　　　"t"
        </code></pre>
<p>画面の実行結果をみても、この通りになっていることが分かります。</p>

<h3>cloneNode</h3>
<p>ノードは、<dfn>cloneNode</dfn>というメソッドを持っています。これは、ノードをコピーするためのものです。</p>
<p>というのも、ノードもオブジェクトの一種だから、<code>var b = a;</code>のようにしてしまうと、bとaは同じものを指してしまい、うまくいきません。しかし、既にあるノードと全く同じノードがもう1つ欲しいということはあると思います。そういう場合につかうのが、cloneNodeです。</p>
<p>サンプルを見てみましょう。</p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;test&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p id="aaaaa"&gt;t&lt;strong&gt;es&lt;/strong&gt;t&lt;/p&gt;

    &lt;script type="text/javascript"&gt;
      var p = document.getElementById('aaaaa');

      var newnode = p.<dfn>cloneNode</dfn>(<mark>true</mark>);

      document.body.appendChild(newnode);
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
        </code></pre>
<p>やっていることは簡単で、変数pにp要素を代入し、pのcloneNodeで同じノードをもう1つつくってnewnodeに代入し、それをbody要素にappendChildで追加しています。</p>
<p>その結果、</p>
<pre><code>body
｜
├―― <mark>p</mark>
｜　　｜
｜　（省略）
｜
（省略）
          </code></pre>
<p>は</p>
<pre><code>body
｜
├―― <mark>p</mark>
｜　　｜
｜　（省略）
｜
（省略）
｜
<mark class="ins"> └―― <mark>p</mark>
  　　　｜
  　　（省略）</mark>

        </code></pre>
<p>のようになって同じpが2つできました。</p>
<p>それでは、cloneNodeの引数であるtrueは何なのでしょう。これを、trueの逆であるfalseに変えてみると、動作が変わります。</p>
<p>実は、この引数にtrueを指定すると、<strong>子ノードも全てコピーします</strong>。対して、falseを指定すると、<strong>そのノードしかコピーしません</strong>。例えば、<code>&lt;p&gt;&lt;/p&gt;</code>の部分だけコピーするようなものです。用途に応じて使い分けましょう。</p>
        <nav>
      <p>
        <a href="index.html" rel="bookmark">戻る</a>
                            |
          <a rel="prev" href="2_6.html">二章第六回</a>
                          |
          <a rel="next" href="2_8.html">二章第八回</a>
              </p>
    </nav>
  </article>

    </main>
  </body>
</html>
    
