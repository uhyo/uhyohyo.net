<!doctype html>
<html lang="ja-jp">
  <head>
    <meta charset="UTF-8">
    <link href="/css/css.css" rel="stylesheet">
                  <link href="/css/js.css" rel="stylesheet">
                        <title>三章第三回　イベントバブリング — JavaScript初級者から中級者になろう &#x2014; uhyohyo.net</title>
      </head>
  <body>
    <header>
      <h1>
        <a href="/">uhyohyo.net</a>
      </h1>
    </header>
    <main>
      
<article> 
  <h1>JavaScript初級者から中級者になろう</h1>
  <aside class="ad-javascript">
    <!-- Google Adsense -->
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:inline-block;width:180px;height:150px"
     data-ad-client="ca-pub-1080533149094679"
     data-ad-slot="7536196754"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </aside>
        <nav>
      <p>
        <a href="index.html" rel="bookmark">戻る</a>
                            |
          <a rel="prev" href="3_2.html">三章第二回</a>
                          |
          <a rel="next" href="3_4.html">三章第四回</a>
              </p>
    </nav>
    <h2>三章第三回　イベントバブリング</h2>
<h3>イベントバブリング</h3>
<p>今回は、<dfn>イベントバブリング</dfn>について解説します。ここがとても面白いところです。</p>
<p>次のサンプルを見てみましょう。</p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;test&lt;/title&gt;
  &lt;/head&gt;
  &lt;body <mark>onclick="console.log('body');"</mark> style="background-color:#eee;border:10px solid black"&gt;
    &lt;div <mark>onclick="console.log('div');"</mark> style="background-color:yellow;width:300px;height:300px;padding:10px"&gt;
      &lt;p <mark>onclick="console.log('p');"</mark> style="background-color:aqua"&gt;test&lt;/p&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>body、div、pのそれぞれにonclick属性がついています。また、スタイルシートでいろいろ色分けしています。黄色い部分がdivで、水色の部分がpです。ついでに、bodyには枠もつけてみました。これにより、画面全体がbodyというわけではないということが分かります。木構造は、</p>
<pre><code>body
｜
├――#text　（改行）
｜
└――div
　　　　｜
　　　　├――#text　（改行）
　　　　｜
　　　　└―― p
　　　　　　　｜
　　　　　　　└――#text　　"test"
        </code></pre>
<p>のようになっていますね。久しぶりなので、改行のテキストノードも省略していません。</p>

<p>さて、body要素をクリックすると'body'のログが、div要素なら'div'のログが、p要素なら'p'のログが出るように思います。しかし、やってみると、実際は少し違います。</p>
<p>body要素のときはいいのですが、div要素をクリックすると、「div」が出た後に<strong>「body」</strong>も出ます。さらに、p要素の場合、「p」「div」「body」と3つも出ます。</p>
<p>このことが意味するのは、<strong>ある要素でイベントが起こると、その親要素でもイベントが起こる</strong>ということです。</p>
<p>具体的には、次のようになっています。</p>
<p>例えばp要素をクリックした場合、</p>
<pre><code>body
｜
├――#text　（改行）
｜
└――div
　　　　｜
　　　　├――#text　（改行）
　　　　｜
　　　　└―― <mark>p　　　　　　　　←ここ</mark>
　　　　　　　｜
　　　　　　　└――#text　　"test"
        </code></pre>
<p>まず、ここでイベントが発生し、「p」が表示されます。さらに下にテキストノードもありますが、イベントが発生するのは、そこの<strong>要素</strong>であるということになっています。テキストノードでは発生しません。</p>

<p>その後、</p>
<pre><code>body
｜
├――#text　（改行）
｜
└――<mark>div　　　　　　　　←ここ</mark>
　　　　<mark>｜</mark>
　　　　<mark>├</mark>――#text　（改行）
　　　　<mark>｜</mark>
　　　　<mark>└――</mark> p
　　　　　　　｜
　　　　　　　└――#text　　"test"
          </code></pre>
<p>このようにその親にイベントが<strong>伝わります</strong>。ここで、div要素でもイベントが発生し、「div」が表示されます。</p>
<p>さらに、</p>
<pre><code><mark>body　　　　　　　　←ここ</mark>
<mark>｜</mark>
<mark>├</mark>――#text　（改行）
<mark>｜</mark>
<mark>└――</mark>div
　　　　｜
　　　　├――#text　（改行）
　　　　｜
　　　　└―― p
　　　　　　　｜
　　　　　　　└――#text　　"test"
        </code></pre>
<p>このように、さらに伝わってbody要素でもイベントが発生し、「body」が表示されます。</p>
<p>今回は木構造をbody以下しか書いてませんが、実際にはbodyの上にはさらにhtml要素があるので、html要素でもイベントは発生しています。ただ、html要素にはイベント属性がないため、何も起こりません。</p>

<p>このように、イベントが親へ親へと伝わっていく流れを<dfn>イベントバブリング</dfn>といいます。</p>
<h4>イベントバブリングの利用</h4>
<p>では、このイベントバブリングは、実際にはどんなふうに利用できるのでしょうか。例えば、<strong>複数の要素のイベントをまとめて監視する場合</strong>に使えます。つまり、</p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;test&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div&gt;
      &lt;p onclick="console.log('p');"&gt;test&lt;/p&gt;
      &lt;p onclick="console.log('p');"&gt;test&lt;/p&gt;
      &lt;p onclick="console.log('p');"&gt;test&lt;/p&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>こういう場合、3つのp要素がそれぞれイベント属性を持つのは無駄です。そこで、その親であるdiv要素でイベントを監視すれば、1つのイベント属性にまとめることができます。</p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;test&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div <mark class="ins">onclick="console.log('p');"</mark>&gt;
      &lt;p&gt;test&lt;/p&gt;
      &lt;p&gt;test&lt;/p&gt;
      &lt;p&gt;test&lt;/p&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>ちなみに、さっきからイベント属性を例として使っていますが、addEventListenerでJavaScriptからイベントを登録する場合も同じです。</p>
<p>さて、しかし、上に示した例では、p要素のイベントをdiv要素に動かしただけでは不完全です。なぜなら、上の例では「div要素の中のp要素」をクリックしたときにイベントが発生するのに対し、下の書き換えたあとの例では、div要素の中ならp要素でなくても反応してしまうからです。</p>
<p>こういった問題点を直す方法は、後で解説します。今回はイベントバブリングの仕組みを紹介しました。</p>
        <nav>
      <p>
        <a href="index.html" rel="bookmark">戻る</a>
                            |
          <a rel="prev" href="3_2.html">三章第二回</a>
                          |
          <a rel="next" href="3_4.html">三章第四回</a>
              </p>
    </nav>
  </article>

    </main>
  </body>
</html>
    
