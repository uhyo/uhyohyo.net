<!doctype html>
<html lang="ja-jp">
  <head>
    <meta charset="UTF-8">
    <link href="/css/css.css" rel="stylesheet">
                  <link href="/css/js.css" rel="stylesheet">
                        <title>六章第三回　XHTMLとDOM — JavaScript初級者から中級者になろう &#x2014; uhyohyo.net</title>
      </head>
  <body>
    <header>
      <h1>
        <a href="/">uhyohyo.net</a>
      </h1>
    </header>
    <main>
      
<article> 
  <h1>JavaScript初級者から中級者になろう</h1>
  <aside class="ad-javascript">
    <!-- Google Adsense -->
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:inline-block;width:180px;height:150px"
     data-ad-client="ca-pub-1080533149094679"
     data-ad-slot="7536196754"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </aside>
        <nav>
      <p>
        <a href="index.html" rel="bookmark">戻る</a>
                            |
          <a rel="prev" href="6_2.html">六章第二回</a>
                          |
          <a rel="next" href="7_1.html">七章第一回</a>
              </p>
    </nav>
    <h2>六章第三回　XHTMLとDOM</h2>
<p>今回は、DOMでXHTMLを扱うときの方法について解説します。とはいっても基本はHTMLと同じなので、専らXHTMLというよりXMLに特有の扱い方を解説することになります。</p>

<h3>タグ名の大文字と小文字</h3>
<p>HTMLではノードのtagNameを見たときそのタグ名は大文字でしたが、XHTMLになると違います。前解説したように、XHTML(XML)ではタグ名の大文字と小文字は区別され、XHTMLのタグ名は小文字に統一されています。つまり、tagNameなどを見たときも小文字になるということです。</p>
<pre><code>&lt;?xml version="1.0" ?&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
  &lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;title&gt;test&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;test&lt;/p&gt;

    &lt;script type="text/javascript"&gt;
      &lt;![CDATA[
        console.log(document.documentElement.tagName);
      ]]&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
          </code></pre>
<p>
  これを実行すると、小文字で"html"と表示されます。document.documentElementは<a href="3_5.html">三章第五回</a>ででてきたものでその文書のルート要素、つまりXHTMLの場合はhtml要素でした。そのタグ名というわけです。</p>
<p>XHTMLのサンプルを実行できない場合、拡張子を「htm」「html」でなく「xhtml」にするとうまくいくかもしれません。</p>

<h3>ノードと名前空間</h3>
<h4>名前空間の情報を得る</h4>
<p>次の場合を見てみましょう。</p>
<pre><code>&lt;?xml version="1.0" ?&gt;
&lt;<mark class="ins">xhtml:</mark>html xmlns<mark class="ins">:xhtml</mark>="http://www.w3.org/1999/xhtml"&gt;
  &lt;<mark class="ins">xhtml:</mark>head&gt;
    &lt;<mark class="ins">xhtml:meta charset="UTF-8" /&gt;
    &lt;<mark class="ins">xhtml:</mark>title&gt;test&lt;/<mark class="ins">xhtml:</mark>title&gt;
  &lt;/<mark class="ins">xhtml:</mark>head&gt;
  &lt;<mark class="ins">xhtml:</mark>body&gt;
    &lt;<mark class="ins">xhtml:</mark>p&gt;test&lt;/<mark class="ins">xhtml:</mark>p&gt;

    &lt;<mark class="ins">xhtml:</mark>script type="text/javascript"&gt;
      &lt;![CDATA[
        console.log(document.documentElement.tagName);
      ]]&gt;&lt;/<mark class="ins">xhtml:</mark>script&gt;
  &lt;/<mark class="ins">xhtml:</mark>body&gt;
&lt;/<mark class="ins">xhtml:</mark>html&gt;
          </code></pre>
<p>デフォルト名前空間を使用せずに、名前空間接頭辞にxhtmlを使って書いた形です。</p>
<p>このとき、html要素のtagNameは"xhtml:html"となっています。つまり、tagNameには<strong>名前空間接頭辞も含んだタグ名が入っている</strong>ということです。</p>
<p>ちなみにこのように名前空間接頭辞も含んだタグ名は「qualified name」の略で「QName」とよばれます。</p>

<p>名前空間接頭辞と、それ以外を別々に取得する方法もあります。</p>
<pre><code>&lt;?xml version="1.0" ?&gt;
&lt;<mark class="ins">xhtml:</mark>html xmlns<mark class="ins">:xhtml</mark>="http://www.w3.org/1999/xhtml"&gt;
  &lt;<mark class="ins">xhtml:</mark>head&gt;
    &lt;<mark class="ins">xhtml:meta charset="UTF-8" /&gt;
    &lt;<mark class="ins">xhtml:</mark>title&gt;test&lt;/<mark class="ins">xhtml:</mark>title&gt;
  &lt;/<mark class="ins">xhtml:</mark>head&gt;
  &lt;<mark class="ins">xhtml:</mark>body&gt;
    &lt;<mark class="ins">xhtml:</mark>p&gt;test&lt;/<mark class="ins">xhtml:</mark>p&gt;

    &lt;<mark class="ins">xhtml:</mark>script type="text/javascript"&gt;
      &lt;![CDATA[
        console.log(document.documentElement.<dfn>prefix</dfn>);
        console.log(document.documentElement.<dfn>localName</dfn>);
      ]]&gt;&lt;/<mark class="ins">xhtml:</mark>script&gt;
  &lt;/<mark class="ins">xhtml:</mark>body&gt;
&lt;/<mark class="ins">xhtml:</mark>html&gt;
          </code></pre>
<p>prefixとlocalNameという2つのプロパティが出てきました。<dfn>prefix</dfn>が接頭辞、<dfn>localName</dfn>がローカル名（接頭辞を含まないタグ名）です。</p>

<p>また、名前空間の実体は接頭辞ではなくURI、例えばXHTMLの場合はhttp://www.w3.org/1999/xhtmlでした。こちらを取得したいという場合もあると思います。むしろ、同じ名前空間でも名前空間接頭辞は自由に決められるので、こちらを取得したい場合のほうが多いのではないでしょうか。それもちゃんとできます。</p>
<pre><code>&lt;?xml version="1.0" ?&gt;
&lt;<mark class="ins">xhtml:</mark>html xmlns<mark class="ins">:xhtml</mark>="http://www.w3.org/1999/xhtml"&gt;
  &lt;<mark class="ins">xhtml:</mark>head&gt;
    &lt;<mark class="ins">xhtml:meta charset="UTF-8" /&gt;
    &lt;<mark class="ins">xhtml:</mark>title&gt;test&lt;/<mark class="ins">xhtml:</mark>title&gt;
  &lt;/<mark class="ins">xhtml:</mark>head&gt;
  &lt;<mark class="ins">xhtml:</mark>body&gt;
    &lt;<mark class="ins">xhtml:</mark>p&gt;test&lt;/<mark class="ins">xhtml:</mark>p&gt;

    &lt;<mark class="ins">xhtml:</mark>script type="text/javascript"&gt;
      &lt;![CDATA[
        console.log(document.documentElement.<dfn>namespaceURI</dfn>);
      ]]&gt;&lt;/<mark class="ins">xhtml:</mark>script&gt;
  &lt;/<mark class="ins">xhtml:</mark>body&gt;
&lt;/<mark class="ins">xhtml:</mark>html&gt;
          </code></pre>
<p>この<dfn>namespaceURI</dfn>に名前空間のURIが入っています。「namespace」が名前空間のことです。</p>

<h4>名前空間を持ったノードを作る</h4>
<p>さて、上のnamespaceURIは書き換えられません。だから、あるノードを作るとき、そのノードが属する名前空間は<strong>作るときに決める</strong>ことが必要になります。</p>
<p>そのためのものがあります。</p>
<pre><code>&lt;?xml version="1.0" ?&gt;
&lt;<mark class="ins">xhtml:</mark>html xmlns<mark class="ins">:xhtml</mark>="http://www.w3.org/1999/xhtml"&gt;
  &lt;<mark class="ins">xhtml:</mark>head&gt;
    &lt;<mark class="ins">xhtml:meta charset="UTF-8" /&gt;
    &lt;<mark class="ins">xhtml:</mark>title&gt;test&lt;/<mark class="ins">xhtml:</mark>title&gt;
  &lt;/<mark class="ins">xhtml:</mark>head&gt;
  &lt;<mark class="ins">xhtml:</mark>body&gt;
    &lt;<mark class="ins">xhtml:</mark>p&gt;test&lt;/<mark class="ins">xhtml:</mark>p&gt;

    &lt;<mark class="ins">xhtml:</mark>script type="text/javascript"&gt;&lt;![CDATA[
      var newp = document.<dfn>createElementNS</dfn>(<mark>"http://www.w3.org/1999/xhtml"</mark>, <mark>"xhtml:p"</mark>);

      newp.appendChild(document.createTextNode("newp"));

      document.body.appendChild(newp);

      console.log(newp.namespaceURI);
    ]]&gt;&lt;/<mark class="ins">xhtml:</mark>script&gt;
  &lt;/<mark class="ins">xhtml:</mark>body&gt;
&lt;/<mark class="ins">xhtml:</mark>html&gt;
          </code></pre>
<p>ここで、名前空間を指定して要素のノードを作っているのは<dfn>createElementNS</dfn>というメソッドです。createElement（<a href="2_5.html">二章第五回</a>）の名前空間あり版です。</p>

<p>引数も2つに増えていて、1つめが名前空間のURI、2つめが接頭辞つきのタグ名（QName）です。</p>
<p>これで名前空間に属するノードができます。最後にconsole.logでnamespaceURIを表示していますが、ちゃんと"http://www.w3.org/1999/xhtml"が表示されます。</p>
<p>ちなみに、createElementNSの次にテキストノードを作って追加していますが、テキストノードは特に名前空間に属したりはしないので、特に変わりません。</p>

<p>また、接頭辞は新しく要素を作るときにはあまり関係ありません。</p>
<pre><code>&lt;?xml version="1.0" ?&gt;
&lt;<mark class="ins">xhtml:</mark>html xmlns<mark class="ins">:xhtml</mark>="http://www.w3.org/1999/xhtml"&gt;
  &lt;<mark class="ins">xhtml:</mark>head&gt;
    &lt;<mark class="ins">xhtml:meta charset="UTF-8" /&gt;
    &lt;<mark class="ins">xhtml:</mark>title&gt;test&lt;/<mark class="ins">xhtml:</mark>title&gt;
  &lt;/<mark class="ins">xhtml:</mark>head&gt;
  &lt;<mark class="ins">xhtml:</mark>body&gt;
    &lt;<mark class="ins">xhtml:</mark>p&gt;test&lt;/<mark class="ins">xhtml:</mark>p&gt;

    &lt;<mark class="ins">xhtml:</mark>script type="text/javascript"&gt;&lt;![CDATA[
      var newp = document.<dfn>createElementNS</dfn>("http://www.w3.org/1999/xhtml", "<mark>aaaaaaa</mark>:p");

      newp.appendChild(document.createTextNode("newp"));

      document.body.appendChild(newp);

      console.log(newp.namespaceURI);
    ]]&gt;&lt;/<mark class="ins">xhtml:</mark>script&gt;
  &lt;/<mark class="ins">xhtml:</mark>body&gt;
&lt;/<mark class="ins">xhtml:</mark>html&gt;</code></pre>
<p>のようにしても正しくXHTMLの名前空間に属します。</p>
<p>だから、事実上接頭辞は省略できます。第二引数はただ単に"p"としても一応問題ないわけです。</p>
<p>また、名前空間を含む文書で普通のcreateElementを使用した場合、名前空間に属しません。そのため、XHTML文書でcreateElementNSではなくcreateElementを使うと、XHTMLの語彙には含まれない謎の要素が生成されたことになり、期待する動作をしてくれません。注意しましょう。</p>

<h4>getElementsByTagNameNS</h4>
<p>getElementsByTagNameの名前空間対応版もあります。それが<dfn>getElementsByTagNameNS</dfn>です。これが威力を発揮するのは、例えばXHTMLに他の名前空間の語彙を埋め込んだ（使った）場合など、</p>
<pre><code>&lt;?xml version="1.0" ?&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" <mark>xmlns:abc="http://example.com/abc"</mark>&gt;
  &lt;head&gt;
    &lt;title&gt;test&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;&lt;a href="http://google.com/"&gt;Go<mark>&lt;abc:a&gt;</mark>ogl<mark>&lt;/abc:a&gt;</mark>e&lt;/a&gt;&lt;/p&gt;
    &lt;p&gt;&lt;a href="http://google.com/"&gt;<mark>&lt;abc:a&gt;</mark>Goo<mark>&lt;/abc:a&gt;</mark>gle&lt;/a&gt;&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
          </code></pre>
<p>この中からリンクのa（XHTMLのa）だけを抜き出したい場合に威力を発揮したりします。</p>
<p>例えば、次のようにします。</p>
        <pre><code>document.<strong>getElementsByTagNameNS</strong>(<mark>"http://www.w3.org/1999/xhtml"</mark>, <mark>"a"</mark>)</code></pre>
<p>第一引数が名前空間で、第二引数がタグ名です。これで、指定したタグのち、その名前空間に属するものだけを取得できます。</p>
<p>注意するのが、createElementNSのときはタグ名がQNameだったのに対し、今回は<strong>ローカル名</strong>（接頭辞がつかない名前）です。</p>

<p>また、名前空間は関係なく、とにかくaなら全て抜き出したいという場合もあるかもしれません。そういう場合普通のgetElementsByTagNameを使えばいいように思えますが、実は名前空間がある文書の場合、getElementsByTagNameはどんな動作をするか<strong>決まっていません</strong>。すなわち、名前空間がある文書の場合はgetElementsByTagNameは使うべきではないのです。</p>
<p>それではどうすればいいかというと、getElementsByTagNameNSの第一引数に<strong>"*"</strong>を指定すると、全ての名前空間から探すことができます。</p>

<h3>属性の名前空間</h3>
<p>前回解説しませんでしたが、実は属性も名前空間を持ちます。</p>
<p>つまり、例えば</p>
        <pre><code>&lt;abc:a <mark>abc:</mark>aaa="aaaaaa" /&gt;</code></pre>
<p>という感じですね。このabcも名前空間接頭辞で、タグ名に使うのとまったく同じです。</p>
<p>さて、そうはいっても、タグ名と属性では少し違う部分があります。</p>
<p>タグ名に接頭辞がつかない場合はデフォルト名前空間に属することになっていましたが、属性の場合そうではありません。そういう場合、属性は<strong>名前空間に属しません</strong>。その属性は「要素に属する」ということになっています。</p>
<p>この要素に属しているという関係は、HTMLのときのそれと同じです。HTMLの属性も要素に属しているものでした。要素に属しているから、その要素が名前空間に属しているから自分自身は属していなくても問題ないのです。</p>
<p>それに対し、属性に接頭辞をつけた場合、その属性は<strong>グローバル属性</strong>というものになります。この属性は、「要素から独立している」のだそうです。一応要素とくっついていますが、要素に属しているというわけではないらしいです。例えば、</p>
        <pre><code>&lt;xhtml:a href="http://google.com/" <mark>abc:aaa="aaaa"</mark>&gt;</code></pre>
<p>のような場合に、このa要素はxhtmlの名前空間に属する要素です。hrefは名前空間に属していないから、このa要素に属していることになりますが、対してabc:aaa属性は、別の名前空間のabcに属する属性ということになります。</p>
<p>このときこのaaaはグローバル属性です。XHTMLで書かれた文書に何か独自の情報を追加したいとき、このように別の名前空間の語彙を要素の属性としてくっつけておくことができます。</p>
<p>もともと属する名前空間が違うから、このa要素はaaaなんて属性は知りません。だから、aaaがa要素に属しているというわけではないのです。そういう意味で、このaaaは独立しているといえます。</p>

<p>これらの属性は、JavaScriptでの扱い方が違います。グローバル属性でない場合（要素に属した属性の場合）、HTMLの名前空間が無い場合と同じだから、今まで同様getAttributeとsetAttribute（<a href="2_10.html">二章第十回</a>）で操作できます。</p>
<p>対して、グローバル属性は、名前空間に属しているから扱い方が違います。</p>
        <pre><code>&lt;a aaa:<mark>abc</mark>="..." bbb:<mark>abc</mark>="..." /&gt;</code></pre>
<p>のような場合に区別する必要があるからですね。</p>
<p>ここで使うのが、<dfn>getAttributeNS</dfn>と<dfn>setAttributeNS</dfn>です。</p>

<p>まず、getAttributeNSは引数が2つになりました。</p>
<pre><code>&lt;?xml version="1.0" ?&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" <mark>xmlns:abc="http://example.com/abc"</mark>&gt;
  &lt;head&gt;
    &lt;title&gt;test&lt;/title&gt;
  &lt;/head&gt;
  &lt;body <mark>abc:aaa="ababababab"</mark>&gt;
    &lt;p&gt;test&lt;/p&gt;

    &lt;script type="text/javascript"&gt;&lt;![CDATA[
      console.log(document.body.<strong>getAttributeNS</strong>(<mark>"http://example.com/abc"</mark>, <mark>"aaa"</mark>) );
    ]]&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
          </code></pre>
<p>第一引数は名前空間のURIで、第二引数が属性のローカル名（接頭辞がつかない名前）です。</p>

<p><dfn>setAttributeNS</dfn>も引数が1つ増えます。</p>
<pre><code>&lt;?xml version="1.0" ?&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" <mark>xmlns:abc="http://example.com/abc"</mark>&gt;
  &lt;head&gt;
    &lt;title&gt;test&lt;/title&gt;
  &lt;/head&gt;
  &lt;body <mark>abc:aaa="ababababab"</mark>&gt;
    &lt;p&gt;test&lt;/p&gt;

    &lt;script type="text/javascript"&gt;&lt;![CDATA[
      document.body.<strong>setAttributeNS</strong>(<mark>"http://example.com/abc"</mark>, <mark>"abc:aaa"</mark>, "cccccc");
    ]]&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
          </code></pre>
<p>第一引数が名前空間、第二引数が属性名、第三引数が変更後の値ということになります。</p>
<p>ここで注意するのが、getAttributeNSではローカル名だった第二引数が、setAttributeNSではQName（接頭辞も含む名前）になっていることです。とはいっても、createElementNSのそれと同じようにローカル名だけでも動作はします。</p>
<p>以上でXHTML・XMLに関する解説は終了です。ここで解説しなかったことに関しては、だいたいはHTMLのノウハウが通用します（というより、DOMとはそもそもXMLを操作するためのものであって、それをHTMLにも適用しているのだということもできます）。</p>
        <nav>
      <p>
        <a href="index.html" rel="bookmark">戻る</a>
                            |
          <a rel="prev" href="6_2.html">六章第二回</a>
                          |
          <a rel="next" href="7_1.html">七章第一回</a>
              </p>
    </nav>
  </article>

    </main>
  </body>
</html>
    
