<!doctype html>
<html lang="ja-jp">
  <head>
    <meta charset="UTF-8">
    <link href="/css/css.css" rel="stylesheet">
                  <link href="/css/js.css" rel="stylesheet">
                        <title>五章第三回　CSSの操作 — JavaScript初級者から中級者になろう &#x2014; uhyohyo.net</title>
        <script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-46093038-1', 'auto');
ga('send', 'pageview');
    </script>
  </head>
  <body>
    <header>
      <h1>
        <a href="/">uhyohyo.net</a>
      </h1>
    </header>
    <main>
      
<article> 
  <h1>JavaScript初級者から中級者になろう</h1>
  <aside class="ad-javascript">
    <!-- Google Adsense -->
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:inline-block;width:180px;height:150px"
     data-ad-client="ca-pub-1080533149094679"
     data-ad-slot="7536196754"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </aside>
        <nav>
      <p>
        <a href="index.html" rel="bookmark">戻る</a>
                            |
          <a rel="prev" href="5_2.html">五章第二回</a>
                          |
          <a rel="next" href="6_1.html">六章第一回</a>
              </p>
    </nav>
    <h2>五章第三回　CSSの操作</h2>
<p>前回は、CSSがどのような構造をしているのか説明しました。今回は、その構造をいじることについて解説します。前回は、構造の末端にあるCSSStyleDeclarationも解説したので、それを操作するくらいならできるようになったと思います。</p>

<h3>CSSRuleの追加と削除</h3>
<p>まず、CSSRuleを子(?)に持つCSSStyleSheetやCSSMediaRuleに、CSSRuleそのものを追加したり、あるいは削除したりする方法を解説します。</p>
<p>CSSStyleSheet（やCSSMediaRule）は、<dfn>insertRule</dfn>と<dfn>deleteRule</dfn>という2つのメソッドを持っています。その名の通り、insertRuleは新しいCSSRuleを追加、deleteRuleは今あるCSSRuleを除去するメソッドです。</p>

<h4>insertRule</h4>
<p>まずinsertRuleの使い方から見ていきます。insertRuleは2つの引数を持ち、ひとつめの引数は<strong>追加するルール</strong>、ふたつめの引数は<strong>追加する位置</strong>です。これは何番目かを数値で指定するもので、ルールがその位置に追加されます。最初は0番目だから、たとえば0を指定すると一番先頭に追加されるということです。</p>
<p>ひとつめの引数のルールはどのような形で指定するかですが、appendChildなどのときはノードのオブジェクトを作成してそれを引数にしました。今回同じようにCSSRuleを何らかの方法で作って渡すのかというと、実はそうではありません。ここには、追加したいルールをそのまま<strong>文字列</strong>で指定します。具体的なサンプルを見てみると、</p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;test&lt;/title&gt;
    &lt;style type="text/css"&gt;
      body {
          background-color: aqua;
      }
      div {
          background-color: white;
      }
      p {
          background-color: yellow;
      }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;testtest&lt;/p&gt;

    &lt;script type="text/javascript"&gt;
      var stylesheet = document.styleSheets.item(0);

      stylesheet.<strong>insertRule</strong>(<mark>"body { background-color:#00ff00; }"</mark>, stylesheet.cssRules.length);
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>という感じです。insertRuleの第一引数には、</p>
        <pre><code>body { background-color:#00ff00; }</code></pre>
<p>という、CSSで書く形がそのまま渡されています。これを渡すと、JavaScript側が解釈してCSSRuleをつくって追加してくれます。今回の場合、CSSStyleRuleが作られたことになりますね。</p>
<p>全体的に確認しておくと、変数stylesheetには、最初の行でCSSStyleSheetが代入されています。また、insertRuleの第二引数は<code>stylesheet.cssRules.length</code>が渡されています。cssRulesはそのCSSStyleSheetが持つCSSRuleの一覧で、lengthはその個数ということになります。だから、例えばlengthが3のとき、CSSRuleは0番目から2番目まであるということです。同様にlengthが5なら4番目まで、10なら9番目まであることになります。つまり、(length-1)番目までCSSRuleがあることになります。したがって、length番目に追加すると、それが一番最後に追加されます。この書き方は、一番最後に追加するための書き方だったのです。</p>

<p>さて、実行してみると、新しいCSSRuleが追加されて、新しいのに従って背景が緑に変わりました。これで、ページ全体に自由なスタイルを適用することができます。</p>
<p>また、すでにbodyの背景色を指定する</p>
<pre><code>body {
  background-color: aqua;
}</code></pre>
<p>というのがありますが（これは0番目にあたりますね）、これとの兼ね合いも多少解説します。このように重複する指定があった場合、番号が大きいほうが優先されます。今回の場合、もともとあったのは0番、JavaScriptで追加したのは3番になるから、追加したほうが優先されます。</p>
<p>基本的に新しいスタイルを追加したいときは、一番最後に追加していきましょう。そうすれば、もともとあったもののほうが優先されるということはありません。</p>
<p>ちなみに、試しにinsertRuleの第二引数を0にしてみましょう。そうすると一番最初に追加されるから、もともとあった指定は1番目に移動し、その結果もともとあった方が優先されるため追加してもそのスタイルは反映されません。これらはCSSの、同じ優先度の規則が複数あって重複する場合、あとに書いてあるほうを優先するというルールに従っています。</p>

<h4>deleteRule</h4>
<p>deleteRuleは、CSSRuleを1つ削除するメソッドです。引数は1つで、insertRuleと同じく数値です。その番号のCSSRuleがなくなります。</p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;test&lt;/title&gt;
    &lt;style type="text/css"&gt;
      body {
          background-color: aqua;
      }
      div {
          background-color: white;
      }
      p {
          background-color: yellow;
      }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;testtest&lt;/p&gt;

    &lt;script type="text/javascript"&gt;
      var stylesheet = document.styleSheets.item(0);

      stylesheet.<strong>deleteRule</strong>(0);
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>このコードでは、0番目、つまり最初の</p>
<pre><code>body {
  background-color: aqua;
}</code></pre>
<p>を削除していることになります。だから、bodyの背景色の指定がなくなって、背景はデフォルトの白（大抵の場合）になります。</p>

<h3>CSSStyleSheetの追加と削除</h3>
<p>上では、もともとあるCSSStyleSheetに新しいルールなどを追加するものでした。しかし、JavaScriptで新しいスタイルなどを作りたい場合、その文書にもともとCSSStyleSheetが（style要素やlink要素が）存在していない場合がありえます。そこで、CSSStyleSheetそのものを新しく作る必要がでてきます。</p>
<p>実は、DOMではCSSStyleSheetを直接作って追加する方法は提供されていません。そこで、どうするかというと、<strong>style要素を新しく作って追加します</strong>。style要素やlink要素とCSSStyleSheetは一対一で対応しているから、こうすることで間接的に新しいCSSStyleSheetをつくったことになります。</p>
<p>そしてできた要素ノードの<dfn>sheet</dfn>というプロパティが、その要素のCSSStyleSheetを表しています。CSSStyleSheet側からHTMLElementを取得するのがownerNodeプロパティで、その逆をたどるのがsheetプロパティというわけですね。できたCSSStyleSheetは空っぽだから、insertRuleで追加していくことになります。</p>
<p>つまり、例えばp要素の背景を黄色くしたい場合、</p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;test&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;なんとかなんとか&lt;/p&gt;
    &lt;p&gt;なんとかかんとか&lt;/p&gt;
    &lt;p&gt;かんとかかんとか&lt;/p&gt;

    &lt;script type="text/javascript"&gt;
      var newStyle = document.createElement('style');
      newStyle.type = "text/css";

      document.getElementsByTagName('head').item(0).appendChild(newStyle);
      newStyle.<mark>sheet</mark>.insertRule("p { background-color:yellow; }",0);
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>できたstyle要素のノードのプロパティtypeに設定しているのは、style要素のtype属性に相当するものです。<code>&lt;style <mark>type="text/css"</mark>&gt;</code>の部分ですね。</p>
<p>その次は、<code>document.getElementsByTagName('head').item(0)</code>にappendChildでstyle要素を追加しています。これは、0番目のhead要素ということです。head要素は文書中に1個しかありませんね。これで、正しくstyle要素が追加されました。</p>
<p>それができたら、insertRuleでいよいよ具体的なルールを追加します。今回insertRuleの第二引数が0ですが、もともと空っぽなので大した問題にはなりません。</p>
<p>ちなみに、前回解説したCSSImportRuleで読み込まれたスタイルシートのCSSStyleSheetは、対応するノードが存在しません。その場合はnullです。</p>

<h4>削除</h4>
<p>CSSStyleSheetを削除するときも、同様に対応する要素を削除します。CSSImportRuleの場合は、そのCSSImportRuleをdeleteRuleで取り除きましょう。</p>
<p>つまり、こんな感じです。</p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;test&lt;/title&gt;
    &lt;style type="text/css"&gt;
      body {
        background-color: aqua;
      }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;testtest&lt;/p&gt;
      &lt;script type="text/javascript"&gt;
        var stylesheet = document.styleSheets.item(0);

        var ele = stylesheet.<mark>ownerNode</mark>;
        ele.parentNode.removeChild(ele);
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>変数stylesheetはひとつあるstyle要素のCSSStyleSheetです。</p>
<p>変数eleに代入しているのはownerNodeです。つまりstyle要素ですね。</p>
<p>その次の行でremoveChildでそのstyle要素を除去しています。removeChildは<a href="2_4.html">二章第四回</a>で出てきました。引数で指定した子ノードを除去するというものです。</p>
<p>つまり、つまり、eleを子ノードとして持つノード、つまりeleの親ノードに対してremoveChildを実行する必要があります。eleの親ノードは、つまりele.parentNodeです。</p>
<p>このサンプルを実行してみると、スタイルシートがなくなったことがわかります。</p>
        <nav>
      <p>
        <a href="index.html" rel="bookmark">戻る</a>
                            |
          <a rel="prev" href="5_2.html">五章第二回</a>
                          |
          <a rel="next" href="6_1.html">六章第一回</a>
              </p>
    </nav>
  </article>

    </main>
  </body>
</html>
    
