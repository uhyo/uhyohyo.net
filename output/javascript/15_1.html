<!doctype html>
<html lang="ja-jp">
  <head>
    <meta charset="UTF-8">
    <link href="/css/css.css" rel="stylesheet">
                  <link href="/css/js.css" rel="stylesheet">
                        <title>十五章第一回　Page Visibility — JavaScript初級者から中級者になろう &#x2014; uhyohyo.net</title>
        <script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-46093038-1', 'auto');
ga('send', 'pageview');
    </script>
  </head>
  <body>
    <header>
      <h1>
        <a href="/">uhyohyo.net</a>
      </h1>
    </header>
    <main>
      
<article> 
  <h1>JavaScript初級者から中級者になろう</h1>
  <aside class="ad-javascript">
    <!-- Google Adsense -->
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:inline-block;width:180px;height:150px"
     data-ad-client="ca-pub-1080533149094679"
     data-ad-slot="7536196754"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </aside>
        <nav>
      <p>
        <a href="index.html" rel="bookmark">戻る</a>
                            |
          <a rel="prev" href="14_5.html">十四章第五回</a>
                          |
          <a rel="next" href="15_2.html">十五章第二回</a>
              </p>
    </nav>
    <h2>十五章第一回　Page Visibility</h2>
<p>今回紹介するのは<dfn>Page Visibility API</dfn>です。これは簡単に述べると、<strong>ユーザーが今このタブを見ているか他のタブを見ているか知ることができる</strong>ものです。これを利用することで、例えば重い処理をするページで、ページが見られていないときは処理を削減したりするなどして軽くする工夫ができます。</p>

<h3>現在の状態を知る</h3>
<p>まず、現在ページが見られているか見られていないかは、Documentのもつ<dfn>hidden</dfn>プロパティを使います。これは真偽値で、trueならユーザーが見ていない、falseなら見ているということです。</p>
<pre><code>if(document.<mark>hidden</mark>){
  //ページは今は見られていない
}else{
  //見られている
}</code></pre>

<p>ちなみに、タブブラウザの場合は見られているか見られていないかは明らかで話は簡単ですが、ブラウザのウィンドウが複数あったりする場合はどうなるでしょうか。</p>
<p>実は、そのページのウィンドウが他のウィンドウに完全に隠されていたり最小化されていたりしたらtrueで、一部分でも見えていたらfalseということになっています。</p>
<p>また、そのページから他のページに移動する瞬間にももう見られないということでfalseになります。</p>

<p>また、より詳しい状態を知るために、もう一つ<dfn>visibilityState</dfn>プロパティがあります。状態を表す文字列が入っています。状態は以下の4つのうちのどれかです。</p>
<dl>
  <dt>"hidden"</dt>
  <dd>ページが、他のタブが見られていたりウィンドウで覆われていたりで見えない場合です。この場合はhiddenプロパティはtrueになっていますね。</dd>
  <dt>"visible"</dt>
  <dd>逆に、ページが見えている状態です。hiddenプロパティがfalseの場合に当てはまります。</dd>
  <dt>"prerender"</dt>
  <dd>これもページが見えない場合ですが、ページが最初から見えない状態で開かれて、そのまま見えていない場合です。これもhiddenプロパティはtrueですね。ただし、面倒な場合はブラウザはこの値を使わない場合もありますので、この値にはあまり期待しないほうがよいでしょう。</dd>
  <dt>"unloaded"</dt>
  <dd>これは同じくhiddenプロパティがtrueの場合のうち、他のページに移動しようとしている場合です。しかしこの値も確実なものではないためあまり期待しないほうがいいです。</dd>
</dl>
<p>以上をまとめると、visibilityStateでは、hiddenプロパティがtrueの場合をさらに3つに分けているということです。しかし"hidden"以外の2つはブラウザによるサポートが必須ではないと定められているため補助的なものとして扱う必要があります。</p>

<h3>状態の変更を検出する</h3>
<p>さて、現在の状況を知るだけではなく、状態が変わったらわからないと意味がありません。それには、Documentで発生する<dfn>visiblitychange</dfn>イベントを利用します。このイベントは単純で、イベントオブジェクトには特に情報はありません。変わったら、hiddenプロパティなどを見て現在の状況を判断します。</p>

<p>サンプルソースとして<a href="15_1_sample.html">サンプル</a>を用意しました。動作を確かめたりソースを見たりしてみて下さい。現在のブラウザの動作を見るに、他のタブを見たりブラウザを最小化すると見えなくなったと判定され、他のウィンドウを上からかぶせただけでは見えなくなったとは認識しないようです。</p>

<p>以上がPage Visibility APIの全てです。簡単ですね。繰り返しになりますが、用途は例えば、重い描画をするゲームを作ったりしたときに、見ていないときは描画を省略して負荷を小さくするなどの使い道があります。</p>
        <nav>
      <p>
        <a href="index.html" rel="bookmark">戻る</a>
                            |
          <a rel="prev" href="14_5.html">十四章第五回</a>
                          |
          <a rel="next" href="15_2.html">十五章第二回</a>
              </p>
    </nav>
  </article>

    </main>
  </body>
</html>
    
